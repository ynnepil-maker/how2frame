<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D é¡ä½å¤§å¸« - V12 ç²¾æº–æ§‹åœ–ç‰ˆ</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; }
        #canvas-container { width: 100vw; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* --- è¦–è¦ºè¼”åŠ©å±¤ --- */
        #overlay-container {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 2;
            display: flex; justify-content: center; align-items: center;
        }

        /* V12 æ”¹å‹•ï¼šç¶ æ¡†æ˜¯è€å¤§ï¼Œä¹å®®æ ¼åœ¨è£¡é¢ */
        #aspect-frame {
            position: absolute;
            border: 2px solid #00ff00; /* ç¶ è‰²å¯¦ç·š */
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7); /* æš—è§’ */
            display: block; 
            pointer-events: none;
            /* è®“å…§éƒ¨çš„ grid-layer å¯ä»¥æ’æ»¿ */
            display: flex;
            flex-wrap: wrap;
        }

        /* V12 æ”¹å‹•ï¼šä¹å®®æ ¼å±¤ï¼Œä½åœ¨ aspect-frame è£¡é¢ */
        #grid-layer {
            width: 100%; height: 100%;
            display: none; /* é è¨­éš±è—ï¼Œç”±æŒ‰éˆ•æ§åˆ¶ */
            flex-wrap: wrap;
        }
        .grid-cell { 
            width: 33.33%; height: 33.33%; 
            box-sizing: border-box; 
            border: 1px solid rgba(255, 255, 255, 0.3); /* åŠé€æ˜ç™½ç·š */
        }
        
        /* ä¸­å¿ƒæº–æ˜Ÿ */
        #center-marker {
            position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
            border-left: 2px solid rgba(255, 0, 0, 0.6); border-top: 2px solid rgba(255, 0, 0, 0.6);
            transform: translate(-10px, -10px); pointer-events: none; z-index: 3;
            display: block;
        }

        /* --- æ‰‹æ©Ÿè¨­å®šæŒ‰éˆ• --- */
        #open-menu-btn {
            position: absolute; top: 20px; left: 20px; z-index: 20;
            padding: 12px 18px; /* åŠ å¤§ */
            background: #ffca28; color: #000;
            border: none; border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); font-size: 16px; /* åŠ å¤§å­—é«” */
            display: flex; align-items: center; gap: 5px;
        }

        /* --- UI é¢æ¿ --- */
        #ui-panel {
            position: absolute; top: 20px; right: 20px; width: 340px; /*ç¨å¾®åŠ å¯¬*/
            background: rgba(0, 0, 0, 0.95); padding: 25px; /*åŠ å¤§å…§è·*/
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8); color: #fff; z-index: 30;
            max-height: 85vh; overflow-y: auto; border: 1px solid #444;
            display: none;
        }
        @media (max-width: 600px) {
            #ui-panel {
                top: 50%; left: 50%; transform: translate(-50%, -50%);
                width: 90%; max-height: 90vh;
            }
        }

        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #555; padding-bottom: 12px; margin-bottom: 18px;
        }
        h2 { margin: 0; font-size: 20px; color: #ffeb3b; } /* æ¨™é¡ŒåŠ å¤§ */
        #close-menu-btn { background: none; border: none; color: #aaa; font-size: 28px; cursor: pointer; padding: 5px;}

        .toggle-group { display: flex; gap: 10px; margin-bottom: 15px; background: #333; padding: 10px; border-radius: 6px; }
        .toggle-btn { width: 100%; padding: 12px; font-size: 15px; cursor: pointer; border: 1px solid #555; border-radius: 4px; background: #222; color: #aaa; text-align: center; }
        .toggle-btn.active { background: #4caf50; color: white; border-color: #4caf50; }

        .nav-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 18px; background: #222; padding: 12px; border-radius: 8px; }
        .nav-btn { padding: 15px 5px; background: #444; color: #fff; border: 1px solid #555; border-radius: 6px; cursor: pointer; font-size: 16px; text-align: center; } /* æŒ‰éˆ•åŠ å¤§ */
        .nav-btn:active { background: #666; }

        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-size: 15px; color: #ccc; } /* æ¨™ç±¤åŠ å¤§ */
        input, select, textarea { width: 100%; padding: 12px; box-sizing: border-box; background: #222; border: 1px solid #555; color: white; border-radius: 6px; font-size: 16px; } /* è¼¸å…¥æ¡†åŠ å¤§ */

        .btn-primary { width: 100%; padding: 14px; background: #ffca28; color: #000; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; margin-top: 10px; }
        .btn-copy { width: 100%; padding: 14px; background: #00e676; color: #000; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; margin-top: 10px; display: none; }
        
        #result-area { margin-top: 15px; padding: 12px; background: #111; border: 1px solid #333; border-radius: 6px; min-height: 70px; font-size: 14px; font-family: 'Courier New', monospace; line-height: 1.5; word-wrap: break-word; color: #ffeb3b; }

        #history-area { margin-top: 25px; border-top: 1px solid #555; padding-top: 15px; }
        .history-title { font-size: 14px; color: #aaa; margin-bottom: 8px; }
        .history-item { background: #222; padding: 12px; margin-bottom: 8px; border-radius: 6px; font-size: 13px; color: #ccc; cursor: pointer; border-left: 4px solid #555; }
        .history-item:hover { background: #333; border-left-color: #ffca28; }

        .disclaimer-box {
            background: rgba(255, 152, 0, 0.15); border: 1px solid #ff9800; border-radius: 6px;
            padding: 12px; margin-bottom: 18px; font-size: 14px; color: #ffb74d; line-height: 1.5;
        }
        .disclaimer-icon { font-size: 18px; margin-right: 5px; vertical-align: middle; }

    </style>
    
    <script src="https://unpkg.com/three@0.126.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="overlay-container">
        <div id="aspect-frame">
            <div id="grid-layer">
                <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
            </div>
        </div>
        <div id="center-marker"></div>
    </div>

    <button id="open-menu-btn">âš™ï¸ åƒæ•¸è¨­å®š</button>

    <div id="ui-panel">
        <div class="panel-header">
            <h2>ğŸŒ é¡ä½å¤§å¸« V12</h2>
            <button id="close-menu-btn">Ã—</button>
        </div>

        <label>è¦–è¦ºè¼”åŠ© (Visual Aids)</label>
        <div class="toggle-group">
            <div class="toggle-btn" id="toggleGrid">ğŸ“… ä¹å®®æ ¼é–‹é—œ</div>
        </div>

        <button id="resetBtn" class="btn-primary" style="background:#444; color:#ddd; margin-top:0; margin-bottom:15px; font-size:14px; padding:10px;">â†º é‡ç½®è¦–è§’</button>

        <div class="nav-label">æ‰‹æ©Ÿè®Šç„¦èˆ‡ç§»å‹• (Zoom & Move)</div>
        <div class="nav-controls">
            <button class="nav-btn" id="navZoomIn">â• æ‹‰è¿‘</button>
            <button class="nav-btn" id="navUp">â¬†ï¸ ä¸Šç§»</button>
            <button class="nav-btn" id="navZoomOut">â– æ‹‰é </button>
            <button class="nav-btn" id="navLeft">â¬…ï¸ å·¦è½‰</button>
            <button class="nav-btn" id="navDown">â¬‡ï¸ ä¸‹ç§»</button>
            <button class="nav-btn" id="navRight">â¡ï¸ å³è½‰</button>
        </div>
        
        <div class="control-group">
            <label>ç•«é¢æ¯”ä¾‹ (æ§‹åœ–ç¶ æ¡†)</label>
            <select id="aspectRatio">
                <option value="16:9" selected>16:9 (æ©«å‘é›»å½±)</option>
                <option value="9:16">9:16 (æ‰‹æ©ŸçŸ­å½±éŸ³)</option>
                <option value="4:3">4:3 (å‚³çµ±é›»è¦–)</option>
                <option value="1:1">1:1 (æ–¹å½¢ IG)</option>
                <option value="21:9">21:9 (è¶…å¯¬è¢å¹•)</option>
            </select>
        </div>

        <div class="control-group">
            <label>é¢¨æ ¼ (Style)</label>
            <select id="style">
                <option value="Photorealistic, 8k, highly detailed" selected>1. å¯«å¯¦ (Realistic)</option>
                <option value="Cinematic lighting, moody">2. é›»å½±æ„Ÿ (Cinematic)</option>
                <option value="Anime style, vibrant colors">3. å‹•æ¼« (Anime)</option>
                <option value="3D render, c4d, blender, octane render">4. 3D (Three Dimensional)</option>
                <option value="Black and white photography, noir">5. é»‘ç™½ (Black & White)</option>
                <option value="SURPRISE_ME">ğŸ² Surprise me ! (éš¨æ©Ÿ)</option>
            </select>
        </div>

        <div class="control-group">
            <label>å ´æ™¯æè¿°</label>
            <textarea id="sceneDesc" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸€ä½ç”·å­åœ¨æŠ½è¸..."></textarea>
        </div>
        
        <div class="disclaimer-box">
            <span class="disclaimer-icon">ğŸ“·</span>
            <b>æ“ä½œæç¤ºï¼š</b><br>
            è«‹ç›´æ¥ç¸®æ”¾æˆ–ç§»å‹•æœ¨å¶äººåˆ°ç¶ æ¡†å…§çš„ç†æƒ³ä½ç½®ã€‚ã€Œæ‰€è¦‹å³æ‰€å¾—ã€ï¼Œä¸ç”¨æ“”å¿ƒç„¦æ®µæ•¸æ“šã€‚
        </div>

        <button id="generateBtn" class="btn-primary">ç”Ÿæˆ Prompt</button>
        
        <div id="result-area">(é»æ“Šç”Ÿæˆ...)</div>
        <button id="copyBtn" class="btn-copy">ğŸ“‹ è¤‡è£½ Prompt</button>

        <div id="history-area">
            <div class="history-title">ğŸ“œ æ­·å²ç´€éŒ„</div>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        // --- UI æ§åˆ¶ ---
        const uiPanel = document.getElementById('ui-panel');
        const openBtn = document.getElementById('open-menu-btn');
        const closeBtn = document.getElementById('close-menu-btn');
        
        if (window.innerWidth > 600) { uiPanel.style.display = 'block'; openBtn.style.display = 'none'; } 
        else { uiPanel.style.display = 'none'; openBtn.style.display = 'flex'; }

        openBtn.addEventListener('click', () => { uiPanel.style.display = 'block'; openBtn.style.display = 'none'; });
        closeBtn.addEventListener('click', () => { uiPanel.style.display = 'none'; openBtn.style.display = 'flex'; });

        // --- è¦–è¦ºè¼”åŠ© (V12 ä¿®æ­£ç‰ˆ) ---
        const gridLayer = document.getElementById('grid-layer'); // æ³¨æ„é€™è£¡æ”¹æŠ“ grid-layer
        const aspectFrame = document.getElementById('aspect-frame');
        const toggleGrid = document.getElementById('toggleGrid');
        const aspectRatioSel = document.getElementById('aspectRatio');

        // ä¹å®®æ ¼é–‹é—œï¼šæ§åˆ¶ grid-layer çš„é¡¯ç¤º
        let isGridOn = false;
        toggleGrid.addEventListener('click', () => {
            isGridOn = !isGridOn;
            gridLayer.style.display = isGridOn ? 'flex' : 'none'; // flex æ‰èƒ½è®“æ ¼å­æ’åˆ—
            toggleGrid.classList.toggle('active', isGridOn);
        });

        // ç¶ æ¡†é‚è¼¯
        updateFrameSize();
        aspectRatioSel.addEventListener('change', updateFrameSize);
        window.addEventListener('resize', updateFrameSize);

        function updateFrameSize() {
            const ratioStr = aspectRatioSel.value;
            const parts = ratioStr.split(':');
            const ratioVal = parseFloat(parts[0]) / parseFloat(parts[1]);
            const margin = 40; 
            const maxW = window.innerWidth - margin;
            const maxH = window.innerHeight - margin;
            let finalW = maxW;
            let finalH = finalW / ratioVal;
            if (finalH > maxH) { finalH = maxH; finalW = finalH * ratioVal; }
            aspectFrame.style.width = finalW + 'px';
            aspectFrame.style.height = finalH + 'px';
        }

        // --- Three.js åˆå§‹åŒ– ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020); 
        scene.fog = new THREE.Fog(0x202020, 5, 50);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const initialCamPos = new THREE.Vector3(-3, 3, 4); 
        camera.position.copy(initialCamPos);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x333333); scene.add(gridHelper);
        const planeGeometry = new THREE.PlaneGeometry(20, 20);
        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2; plane.receiveShadow = true; scene.add(plane);

        const dummyGroup = new THREE.Group();
        const material = new THREE.MeshStandardMaterial({ color: 0xccaa88, roughness: 0.5 });
        const headGroup = new THREE.Group(); headGroup.position.y = 1.75;
        const headMesh = new THREE.Mesh(new THREE.SphereGeometry(0.25, 32, 32), material); headMesh.castShadow = true; headGroup.add(headMesh);
        const nose = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.15), new THREE.MeshStandardMaterial({ color: 0xff3333 })); 
        nose.position.set(0, 0, 0.25); headGroup.add(nose);
        dummyGroup.add(headGroup);
        const body = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.2, 0.7, 32), material); 
        body.position.y = 1.15; body.castShadow = true; dummyGroup.add(body);
        const armGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.7);
        const armL = new THREE.Mesh(armGeo, material); armL.position.set(0.35, 1.2, 0); armL.rotation.z = -0.2; dummyGroup.add(armL);
        const armR = new THREE.Mesh(armGeo, material); armR.position.set(-0.35, 1.2, 0); armR.rotation.z = 0.2; dummyGroup.add(armR);
        const legGeo = new THREE.CylinderGeometry(0.1, 0.08, 0.8);
        const legL = new THREE.Mesh(legGeo, material); legL.position.set(0.15, 0.4, 0); dummyGroup.add(legL);
        const legR = new THREE.Mesh(legGeo, material); legR.position.set(-0.15, 0.4, 0); dummyGroup.add(legR);
        scene.add(dummyGroup);

        const ambientLight = new THREE.AmbientLight(0x404040, 1.5); scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5); dirLight.position.set(5, 10, 7); dirLight.castShadow = true; scene.add(dirLight);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const targetCenter = new THREE.Vector3(0, 1.2, 0);
        controls.target.copy(targetCenter); controls.update();

        document.getElementById('navLeft').addEventListener('click', () => { controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), -0.1); controls.update(); });
        document.getElementById('navRight').addEventListener('click', () => { controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), 0.1); controls.update(); });
        document.getElementById('navZoomIn').addEventListener('click', () => { const dir = new THREE.Vector3(); camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(0.5)); controls.update(); });
        document.getElementById('navZoomOut').addEventListener('click', () => { const dir = new THREE.Vector3(); camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(-0.5)); controls.update(); });
        document.getElementById('navUp').addEventListener('click', () => { camera.position.y += 0.2; controls.target.y += 0.2; controls.update(); });
        document.getElementById('navDown').addEventListener('click', () => { camera.position.y -= 0.2; controls.target.y -= 0.2; controls.update(); });
        document.getElementById('resetBtn').addEventListener('click', () => { camera.position.copy(initialCamPos); controls.target.copy(targetCenter); controls.update(); });

        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
        animate();

        // --- ç”Ÿæˆé‚è¼¯ ---
        const hiddenStyles = ["Cyberpunk style, neon lights, futuristic city", "Watercolor painting, soft pastel colors, artistic", "Claymation style, stop motion, plasticine texture", "Ukiyo-e style, japanese traditional art, woodblock print", "Pixel art, 16-bit game style, retro", "Steampunk, brass gears, steam, victorian industrial", "Synthwave, retro 80s aesthetics, purple and teal grid", "Polaroid photo, vintage film grain, flash photography"];

        document.getElementById('generateBtn').addEventListener('click', () => {
            const focalLen = "35"; 
            const aperture = "f/1.8"; 
            
            let style = document.getElementById('style').value;
            if (style === "SURPRISE_ME") { style = hiddenStyles[Math.floor(Math.random() * hiddenStyles.length)]; }

            const ratioVal = aspectRatioSel.value;
            const aspectRatioTag = `(${ratioVal} aspect ratio)`;
            const userDesc = document.getElementById('sceneDesc').value.trim() || "a character standing";

            const distance = camera.position.distanceTo(controls.target);
            let shotType = "Medium Shot";
            if (distance < 1.5) shotType = "Extreme Close-up"; else if (distance < 2.5) shotType = "Close-up"; else if (distance < 4.5) shotType = "Medium Shot"; else if (distance < 8.0) shotType = "Full Body Shot"; else shotType = "Wide Shot";

            const heightDiff = camera.position.y - controls.target.y;
            let angleType = "Eye-level angle";
            if (heightDiff > 0.8) angleType = "High angle shot"; else if (heightDiff < -0.5) angleType = "Low angle shot";

            let camDirX = camera.position.x - controls.target.x;
            let camDirZ = camera.position.z - controls.target.z;
            const length = Math.sqrt(camDirX * camDirX + camDirZ * camDirZ);
            camDirZ /= length; const dotProduct = camDirZ;

            let facingType = "";
            if (dotProduct > 0.8) { facingType = ", Front view"; } else if (dotProduct < -0.8) { facingType = ", Back view from behind"; } else { if (camera.position.x > controls.target.x) { facingType = ", Side profile view facing left"; } else { facingType = ", Side profile view facing right"; } }

            const dummyPos = new THREE.Vector3(0, 1.2, 0);
            dummyPos.project(camera); 
            let positionPrompt = "";
            if (dummyPos.x < -0.2) { positionPrompt = ", subject on the left, rule of thirds"; } 
            else if (dummyPos.x > 0.2) { positionPrompt = ", subject on the right, rule of thirds"; } 
            else { positionPrompt = ", centered composition"; }

            const finalPrompt = `${style}, ${userDesc}${facingType}, ${shotType}, ${angleType}${positionPrompt}, ${focalLen}mm lens, ${aperture}, depth of field, natural lighting, highly detailed, ${aspectRatioTag}, (best quality), (masterpiece), (highres)`;

            const resultArea = document.getElementById('result-area');
            resultArea.innerText = finalPrompt;

            const copyBtn = document.getElementById('copyBtn');
            copyBtn.style.display = 'block'; copyBtn.innerText = 'ğŸ“‹ è¤‡è£½ Prompt'; copyBtn.style.background = '#00e676';
            addToHistory(finalPrompt);
        });

        const copyBtn = document.getElementById('copyBtn');
        copyBtn.addEventListener('click', () => {
            const text = document.getElementById('result-area').innerText;
            navigator.clipboard.writeText(text).then(() => {
                copyBtn.innerText = 'âœ… å·²è¤‡è£½ï¼'; copyBtn.style.background = '#4caf50';
                setTimeout(() => { copyBtn.innerText = 'ğŸ“‹ è¤‡è£½ Prompt'; copyBtn.style.background = '#00e676'; }, 2000);
            }).catch(err => { alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½'); });
        });

        function addToHistory(text) {
            const list = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerText = text.substring(0, 50) + '...';
            item.addEventListener('click', () => { navigator.clipboard.writeText(text); alert('å·²è¤‡è£½èˆŠ Promptï¼'); });
            list.insertBefore(item, list.firstChild);
            if (list.children.length > 5) { list.removeChild(list.lastChild); }
        }
    </script>
</body>
</html>


