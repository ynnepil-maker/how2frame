<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D é¡ä½å¤§å¸« - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ V8</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; }
        #canvas-container { width: 100vw; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* --- ä¹å®®æ ¼è¼”åŠ©ç·š --- */
        #grid-overlay {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 2;
            display: flex; flex-wrap: wrap;
        }
        .grid-cell { width: 33.33%; height: 33.33%; box-sizing: border-box; border: 1px solid rgba(255, 255, 255, 0.15); }

        /* --- V8 æ–°å¢ï¼šæµ®å‹•çš„ã€Œæ‰“é–‹è¨­å®šã€æŒ‰éˆ• --- */
        #open-menu-btn {
            position: absolute; top: 20px; left: 20px; z-index: 20;
            padding: 10px 15px; background: #ffca28; color: #000;
            border: none; border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            font-size: 14px;
            display: flex; align-items: center; gap: 5px;
        }
        #open-menu-btn:hover { background: #ffd54f; }

        /* --- UI é¢æ¿ (é è¨­éš±è—ï¼Œé€é class æ§åˆ¶é¡¯ç¤º) --- */
        #ui-panel {
            position: absolute; top: 20px; right: 20px; width: 320px;
            background: rgba(0, 0, 0, 0.95); padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8); color: #fff; z-index: 30;
            max-height: 85vh; overflow-y: auto; border: 1px solid #444;
            display: none; /* V8 æ”¹å‹•ï¼šé è¨­éš±è— */
        }

        /* ç•¶è¢å¹•å°æ–¼ 600px (æ‰‹æ©Ÿ) æ™‚çš„æ¨£å¼èª¿æ•´ */
        @media (max-width: 600px) {
            #ui-panel {
                top: 50%; left: 50%; right: auto; bottom: auto;
                transform: translate(-50%, -50%); /* å±…ä¸­é¡¯ç¤º */
                width: 90%; /* å¯¬åº¦ä½” 90% */
                max-height: 90vh;
            }
        }

        /* é¢æ¿æ¨™é¡Œåˆ— (å«é—œé–‰æŒ‰éˆ•) */
        .panel-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #555; padding-bottom: 10px; margin-bottom: 15px;
        }
        h2 { margin: 0; font-size: 18px; color: #ffeb3b; }
        
        #close-menu-btn {
            background: none; border: none; color: #aaa; font-size: 24px; cursor: pointer; padding: 0 5px;
        }
        #close-menu-btn:hover { color: #fff; }

        /* --- å°èˆªæŒ‰éˆ•å€ --- */
        .nav-controls {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 15px;
            background: #222; padding: 10px; border-radius: 6px;
        }
        .nav-btn {
            padding: 12px 5px; background: #444; color: #fff; border: 1px solid #555;
            border-radius: 4px; cursor: pointer; font-size: 14px; text-align: center;
        }
        .nav-btn:hover { background: #555; }
        .nav-btn:active { background: #666; } /* æŒ‰ä¸‹æ•ˆæœ */
        .nav-label { grid-column: span 3; font-size: 12px; color: #aaa; text-align: center; margin-bottom: 5px;}

        /* --- é€šç”¨è¼¸å…¥å…ƒä»¶ --- */
        .control-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: #ccc; }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%; padding: 10px; /* æ‰‹æ©Ÿç‰ˆåŠ å¤§è§¸æ§å€ */
            box-sizing: border-box; background: #222;
            border: 1px solid #555; color: white; border-radius: 4px; font-size: 14px;
        }

        .btn-primary {
            width: 100%; padding: 12px; background: #ffca28; color: #000; border: none;
            border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px;
        }
        .btn-secondary {
            width: 100%; padding: 8px; background: #333; color: #ddd; border: 1px solid #555;
            border-radius: 4px; cursor: pointer; font-size: 13px; margin-bottom: 15px;
        }

        /* çµæœé¡¯ç¤ºå€ */
        #result-area {
            margin-top: 15px; padding: 10px; background: #111; border: 1px solid #333;
            border-radius: 4px; min-height: 80px; font-size: 12px; font-family: 'Courier New', monospace;
            line-height: 1.4; word-wrap: break-word; color: #ffeb3b; user-select: text;
        }
    </style>
    
    <script src="https://unpkg.com/three@0.126.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="grid-overlay">
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
    </div>

    <button id="open-menu-btn">âš™ï¸ åƒæ•¸è¨­å®š</button>

    <div id="ui-panel">
        <div class="panel-header">
            <h2>ğŸŒ é¡ä½å¤§å¸«</h2>
            <button id="close-menu-btn">Ã—</button>
        </div>
        
        <button id="resetBtn" class="btn-secondary">â†º ç•«é¢äº‚æ‰ï¼Ÿé»æˆ‘é‡ç½®</button>

        <div class="nav-label">æ–°æ‰‹å°èˆªæŒ‰éˆ• (æ‰‹æ©Ÿæ•‘æ˜Ÿ)</div>
        <div class="nav-controls">
            <button class="nav-btn" id="navZoomIn">â• æ”¾å¤§</button>
            <button class="nav-btn" id="navUp">â¬†ï¸ ä¸Šç§»</button>
            <button class="nav-btn" id="navZoomOut">â– ç¸®å°</button>
            <button class="nav-btn" id="navLeft">â¬…ï¸ å·¦è½‰</button>
            <button class="nav-btn" id="navDown">â¬‡ï¸ ä¸‹ç§»</button>
            <button class="nav-btn" id="navRight">â¡ï¸ å³è½‰</button>
        </div>

        <div class="control-group">
            <label>ç„¦æ®µ (Focal Length mm)</label>
            <input type="number" id="focalLength" value="35" min="10" max="200">
        </div>
        <div class="control-group">
            <label>å…‰åœˆ (Aperture)</label>
            <select id="aperture">
                <option value="f/1.2" selected>f/1.2 (æ¥µæ·ºæ™¯æ·±)</option>
                <option value="f/1.8">f/1.8 (æ¨™æº–å¤§å…‰åœˆ)</option>
                <option value="f/2.8">f/2.8 (å¸¸ç”¨)</option>
                <option value="f/5.6">f/5.6 (æ¸…æ™°)</option>
                <option value="f/11">f/11 (æ·±æ™¯æ·±)</option>
            </select>
        </div>
        <div class="control-group">
            <label>ç•«é¢æ¯”ä¾‹ (æ§‹åœ–åƒè€ƒ)</label>
            <select id="aspectRatio">
                <option value="(16:9 aspect ratio)" selected>16:9 (æ©«å‘é›»å½±æ„Ÿ)</option>
                <option value="(21:9 aspect ratio)">21:9 (è¶…å¯¬è¢å¹•)</option>
                <option value="(4:3 aspect ratio)">4:3 (å‚³çµ±é›»è¦–)</option>
                <option value="(1:1 aspect ratio)">1:1 (æ–¹å½¢ IG)</option>
                <option value="(9:16 aspect ratio)">9:16 (æ‰‹æ©Ÿå…¨è¢å¹•)</option>
            </select>
        </div>
        <div class="control-group">
            <label>é¢¨æ ¼ (Style)</label>
            <select id="style">
                <option value="Photorealistic, 8k, highly detailed" selected>Photorealistic (å¯«å¯¦)</option>
                <option value="Cinematic lighting, moody">Cinematic (é›»å½±æ„Ÿ)</option>
                <option value="Anime style, vibrant colors">Anime (å‹•æ¼«)</option>
                <option value="Cyberpunk style, neon lights">Cyberpunk (è³½åšé¾å…‹)</option>
            </select>
        </div>
        <div class="control-group">
            <label>å ´æ™¯æè¿°</label>
            <textarea id="sceneDesc" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸€ä½ç”·å­åœ¨æŠ½è¸..."></textarea>
        </div>
        
        <button id="generateBtn" class="btn-primary">ç”Ÿæˆ Nano Banana æç¤ºè©</button>
        <div id="result-area">(èª¿æ•´ç•«é¢å¾Œé»æ“Šç”Ÿæˆ...)</div>
    </div>

    <script>
        // --- V8 æ–°å¢ï¼šUI é–‹é—œé‚è¼¯ ---
        const uiPanel = document.getElementById('ui-panel');
        const openBtn = document.getElementById('open-menu-btn');
        const closeBtn = document.getElementById('close-menu-btn');

        // æ‰“é–‹é¸å–®
        openBtn.addEventListener('click', () => {
            uiPanel.style.display = 'block';
            openBtn.style.display = 'none'; // éš±è—æ‰“é–‹æŒ‰éˆ•
        });

        // é—œé–‰é¸å–®
        closeBtn.addEventListener('click', () => {
            uiPanel.style.display = 'none';
            openBtn.style.display = 'flex'; // é¡¯ç¤ºæ‰“é–‹æŒ‰éˆ•
        });

        // é è¨­å…ˆé–‹å•Ÿä¸€æ¬¡è®“ä½¿ç”¨è€…çŸ¥é“æœ‰é¸å–®ï¼Œç„¶å¾Œå¯ä»¥æ‰‹å‹•é—œ
        // æˆ–è€…ä¿ç•™é è¨­éš±è—ï¼Œé€™è£¡æˆ‘è¨­å®šï¼šå¦‚æœè¢å¹•å¤ å¤§(é›»è…¦)ï¼Œé è¨­é–‹å•Ÿï¼›æ‰‹æ©Ÿé è¨­é—œé–‰
        if (window.innerWidth > 600) {
            uiPanel.style.display = 'block';
            openBtn.style.display = 'none';
        }

        // --- 1. åˆå§‹åŒ– Three.js å ´æ™¯ ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020); 
        scene.fog = new THREE.Fog(0x202020, 5, 50);

        const camera = new THREE.PerspectiveCamera(63, window.innerWidth / window.innerHeight, 0.1, 1000);
        const initialCamPos = new THREE.Vector3(-3, 3, 4); 
        camera.position.copy(initialCamPos);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x333333); scene.add(gridHelper);
        const planeGeometry = new THREE.PlaneGeometry(20, 20);
        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2; plane.receiveShadow = true; scene.add(plane);

        // --- 2. å»ºç«‹æœ¨å¶äºº ---
        const dummyGroup = new THREE.Group();
        const material = new THREE.MeshStandardMaterial({ color: 0xccaa88, roughness: 0.5 });
        const headGroup = new THREE.Group(); headGroup.position.y = 1.75;
        const headGeo = new THREE.SphereGeometry(0.25, 32, 32);
        const headMesh = new THREE.Mesh(headGeo, material); headMesh.castShadow = true; headGroup.add(headMesh);
        const noseGeo = new THREE.BoxGeometry(0.1, 0.1, 0.15);
        const noseMat = new THREE.MeshStandardMaterial({ color: 0xff3333 }); 
        const nose = new THREE.Mesh(noseGeo, noseMat); nose.position.set(0, 0, 0.25); headGroup.add(nose);
        dummyGroup.add(headGroup);
        const body = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.2, 0.7, 32), material); 
        body.position.y = 1.15; body.castShadow = true; dummyGroup.add(body);
        const armGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.7);
        const armL = new THREE.Mesh(armGeo, material); armL.position.set(0.35, 1.2, 0); armL.rotation.z = -0.2; dummyGroup.add(armL);
        const armR = new THREE.Mesh(armGeo, material); armR.position.set(-0.35, 1.2, 0); armR.rotation.z = 0.2; dummyGroup.add(armR);
        const legGeo = new THREE.CylinderGeometry(0.1, 0.08, 0.8);
        const legL = new THREE.Mesh(legGeo, material); legL.position.set(0.15, 0.4, 0); dummyGroup.add(legL);
        const legR = new THREE.Mesh(legGeo, material); legR.position.set(-0.15, 0.4, 0); dummyGroup.add(legR);
        scene.add(dummyGroup);

        const ambientLight = new THREE.AmbientLight(0x404040, 1.5); scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5); dirLight.position.set(5, 10, 7); dirLight.castShadow = true; scene.add(dirLight);

        // --- 3. æ§åˆ¶å™¨ ---
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const targetCenter = new THREE.Vector3(0, 1.2, 0);
        controls.target.copy(targetCenter); controls.update();

        // æŒ‰éˆ•ç›£è½ (å°èˆª)
        document.getElementById('navLeft').addEventListener('click', () => { controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), -0.1); controls.update(); });
        document.getElementById('navRight').addEventListener('click', () => { controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), 0.1); controls.update(); });
        document.getElementById('navZoomIn').addEventListener('click', () => { const dir = new THREE.Vector3(); camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(0.5)); controls.update(); });
        document.getElementById('navZoomOut').addEventListener('click', () => { const dir = new THREE.Vector3(); camera.getWorldDirection(dir); camera.position.add(dir.multiplyScalar(-0.5)); controls.update(); });
        document.getElementById('navUp').addEventListener('click', () => { camera.position.y += 0.2; controls.target.y += 0.2; controls.update(); });
        document.getElementById('navDown').addEventListener('click', () => { camera.position.y -= 0.2; controls.target.y -= 0.2; controls.update(); });
        document.getElementById('resetBtn').addEventListener('click', () => { camera.position.copy(initialCamPos); controls.target.copy(targetCenter); controls.update(); document.getElementById('focalLength').value = 35; updateCameraFOV(); });

        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
        animate();

        // --- 4. ç”Ÿæˆé‚è¼¯ ---
        const focalInput = document.getElementById('focalLength');
        function updateCameraFOV() {
            const focalLength = parseFloat(focalInput.value); if(focalLength <= 0) return;
            const sensorHeight = 24; const fov = 2 * Math.atan(sensorHeight / (2 * focalLength)) * (180 / Math.PI);
            camera.fov = fov; camera.updateProjectionMatrix();
        }
        focalInput.addEventListener('input', updateCameraFOV); updateCameraFOV();

        document.getElementById('generateBtn').addEventListener('click', () => {
            const focalLen = focalInput.value;
            const aperture = document.getElementById('aperture').value;
            const style = document.getElementById('style').value;
            const aspectRatioTag = document.getElementById('aspectRatio').value;
            const userDesc = document.getElementById('sceneDesc').value.trim() || "a character standing";

            const distance = camera.position.distanceTo(controls.target);
            let shotType = "Medium Shot";
            if (distance < 1.5) shotType = "Extreme Close-up";
            else if (distance < 2.5) shotType = "Close-up";
            else if (distance < 4.5) shotType = "Medium Shot";
            else if (distance < 8.0) shotType = "Full Body Shot";
            else shotType = "Wide Shot";

            const heightDiff = camera.position.y - controls.target.y;
            let angleType = "Eye-level angle";
            if (heightDiff > 0.8) angleType = "High angle shot";
            else if (heightDiff < -0.5) angleType = "Low angle shot";

            let camDirX = camera.position.x - controls.target.x;
            let camDirZ = camera.position.z - controls.target.z;
            const length = Math.sqrt(camDirX * camDirX + camDirZ * camDirZ);
            camDirZ /= length; const dotProduct = camDirZ;

            let facingType = "";
            if (dotProduct > 0.8) { facingType = ", Front view"; } 
            else if (dotProduct < -0.8) { facingType = ", Back view from behind"; } 
            else {
                if (camera.position.x > controls.target.x) { facingType = ", Side profile view facing left"; } 
                else { facingType = ", Side profile view facing right"; }
            }

            const finalPrompt = `${style}, ${userDesc}${facingType}, ${shotType}, ${angleType}, ${focalLen}mm lens, ${aperture}, depth of field, natural lighting, highly detailed, ${aspectRatioTag}, (best quality), (masterpiece), (highres)`;
            document.getElementById('result-area').innerText = finalPrompt;
        });
    </script>
</body>
</html>
