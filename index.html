<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D é¡ä½æ§‹åœ–ç”Ÿæˆå™¨ V5 (ä¿æ¯ç´šæ“ä½œç‰ˆ)</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; }
        #canvas-container { width: 100vw; height: 100vh; display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* ä¹å®®æ ¼ */
        #grid-overlay {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 2;
            display: flex; flex-wrap: wrap;
        }
        .grid-cell { width: 33.33%; height: 33.33%; box-sizing: border-box; border: 1px solid rgba(255, 255, 255, 0.15); }

        /* UI é¢æ¿ */
        #ui-panel {
            position: absolute; top: 20px; right: 20px; width: 320px;
            background: rgba(0, 0, 0, 0.9); padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); color: #fff; z-index: 10;
            max-height: 90vh; overflow-y: auto; border: 1px solid #444;
        }

        h2 { margin-top: 0; font-size: 18px; border-bottom: 1px solid #555; padding-bottom: 10px; color: #4285f4; }

        /* V5 æ–°å¢ï¼šè™›æ“¬å°èˆªæŒ‰éˆ•å€ */
        .nav-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 15px;
            background: #222;
            padding: 10px;
            border-radius: 6px;
        }
        .nav-btn {
            padding: 10px 5px; background: #444; color: #fff; border: 1px solid #555;
            border-radius: 4px; cursor: pointer; font-size: 14px; text-align: center;
        }
        .nav-btn:hover { background: #555; }
        .nav-label { grid-column: span 3; font-size: 12px; color: #aaa; text-align: center; margin-bottom: 5px;}

        /* é€šç”¨ UI å…ƒç´  */
        .control-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: #ccc; }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%; padding: 8px; box-sizing: border-box; background: #222;
            border: 1px solid #555; color: white; border-radius: 4px; font-size: 14px;
        }
        .btn-primary {
            width: 100%; padding: 12px; background: #4285f4; color: white; border: none;
            border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px;
        }
        .btn-primary:hover { background: #357abd; }
        .btn-secondary {
            width: 100%; padding: 8px; background: #333; color: #ddd; border: 1px solid #555;
            border-radius: 4px; cursor: pointer; font-size: 13px; margin-bottom: 15px;
        }
        .btn-secondary:hover { background: #444; }

        #result-area {
            margin-top: 15px; padding: 10px; background: #111; border: 1px solid #333;
            border-radius: 4px; min-height: 80px; font-size: 12px; font-family: 'Courier New', monospace;
            line-height: 1.4; word-wrap: break-word; color: #76ff03; user-select: text;
        }
    </style>
    <script src="https://unpkg.com/three@0.126.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="grid-overlay">
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
        <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
    </div>

    <div id="ui-panel">
        <h2>ğŸ¥ é¡ä½å¤§å¸« V5 (ä¿æ¯ç‰ˆ)</h2>
        
        <button id="resetBtn" class="btn-secondary">â†º ç•«é¢äº‚æ‰ï¼Ÿé»æˆ‘ä¸€éµé‡ç½®</button>

        <div class="nav-label">æ–°æ‰‹å°èˆªæŒ‰éˆ• (æ›¿ä»£æ»‘é¼ )</div>
        <div class="nav-controls">
            <button class="nav-btn" id="navZoomIn">ğŸ” æ”¾å¤§</button>
            <button class="nav-btn" id="navUp">â¬†ï¸ ä¸Šç§»</button>
            <button class="nav-btn" id="navZoomOut">ğŸ” ç¸®å°</button>
            <button class="nav-btn" id="navLeft">â¬…ï¸ å·¦è½‰</button>
            <button class="nav-btn" id="navDown">â¬‡ï¸ ä¸‹ç§»</button>
            <button class="nav-btn" id="navRight">â¡ï¸ å³è½‰</button>
        </div>

        <div class="control-group">
            <label>ç„¦æ®µ (Focal Length mm)</label>
            <input type="number" id="focalLength" value="35" min="10" max="200">
        </div>
        <div class="control-group">
            <label>å…‰åœˆ (Aperture)</label>
            <select id="aperture">
                <option value="f/1.2" selected>f/1.2 (æ¥µæ·ºæ™¯æ·±)</option>
                <option value="f/1.8">f/1.8 (æ¨™æº–å¤§å…‰åœˆ)</option>
                <option value="f/2.8">f/2.8 (å¸¸ç”¨)</option>
                <option value="f/5.6">f/5.6 (æ¸…æ™°)</option>
                <option value="f/11">f/11 (æ·±æ™¯æ·±)</option>
            </select>
        </div>
        <div class="control-group">
            <label>ç•«é¢æ¯”ä¾‹ (Aspect Ratio)</label>
            <select id="aspectRatio">
                <option value="--ar 16:9" selected>16:9 (æ©«å‘é›»å½±æ„Ÿ)</option>
                <option value="--ar 21:9">21:9 (è¶…å¯¬è¢å¹•)</option>
                <option value="--ar 4:3">4:3 (å‚³çµ±é›»è¦–)</option>
                <option value="--ar 1:1">1:1 (æ–¹å½¢ IG)</option>
                <option value="--ar 9:16">9:16 (æ‰‹æ©Ÿå…¨è¢å¹•)</option>
            </select>
        </div>
        <div class="control-group">
            <label>é¢¨æ ¼ (Style)</label>
            <select id="style">
                <option value="Photorealistic, 8k, highly detailed" selected>Photorealistic (å¯«å¯¦)</option>
                <option value="Cinematic lighting, moody">Cinematic (é›»å½±æ„Ÿ)</option>
                <option value="Anime style, vibrant colors">Anime (å‹•æ¼«)</option>
                <option value="Cyberpunk style, neon lights">Cyberpunk (è³½åšé¾å…‹)</option>
            </select>
        </div>
        <div class="control-group">
            <label>å ´æ™¯æè¿°</label>
            <textarea id="sceneDesc" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸€ä½ç”·å­åœ¨æŠ½è¸..."></textarea>
        </div>
        <button id="generateBtn" class="btn-primary">ç”Ÿæˆ Prompt</button>
        <div id="result-area">(èª¿æ•´æ§‹åœ–å¾Œï¼Œé»æ“ŠæŒ‰éˆ•ç”Ÿæˆ...)</div>
    </div>

    <script>
        // --- åˆå§‹åŒ– ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x202020); scene.fog = new THREE.Fog(0x202020, 5, 50);
        const camera = new THREE.PerspectiveCamera(63, window.innerWidth / window.innerHeight, 0.1, 1000);
        const initialCamPos = new THREE.Vector3(-3, 3, 4); camera.position.copy(initialCamPos);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x333333); scene.add(gridHelper);
        const planeGeometry = new THREE.PlaneGeometry(20, 20);
        const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2; plane.receiveShadow = true; scene.add(plane);

        // --- æœ¨å¶äºº ---
        const dummyGroup = new THREE.Group();
        const material = new THREE.MeshStandardMaterial({ color: 0xccaa88, roughness: 0.5 });
        const headGroup = new THREE.Group(); headGroup.position.y = 1.75;
        const headGeo = new THREE.SphereGeometry(0.25, 32, 32);
        const headMesh = new THREE.Mesh(headGeo, material); headMesh.castShadow = true; headGroup.add(headMesh);
        const noseGeo = new THREE.BoxGeometry(0.1, 0.1, 0.15);
        const noseMat = new THREE.MeshStandardMaterial({ color: 0xff3333 }); 
        const nose = new THREE.Mesh(noseGeo, noseMat); nose.position.set(0, 0, 0.25); headGroup.add(nose);
        dummyGroup.add(headGroup);
        const bodyGeo = new THREE.CylinderGeometry(0.25, 0.2, 0.7, 32);
        const body = new THREE.Mesh(bodyGeo, material); body.position.y = 1.15; body.castShadow = true; dummyGroup.add(body);
        const armGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.7);
        const armL = new THREE.Mesh(armGeo, material); armL.position.set(0.35, 1.2, 0); armL.rotation.z = -0.2; dummyGroup.add(armL);
        const armR = new THREE.Mesh(armGeo, material); armR.position.set(-0.35, 1.2, 0); armR.rotation.z = 0.2; dummyGroup.add(armR);
        const legGeo = new THREE.CylinderGeometry(0.1, 0.08, 0.8);
        const legL = new THREE.Mesh(legGeo, material); legL.position.set(0.15, 0.4, 0); dummyGroup.add(legL);
        const legR = new THREE.Mesh(legGeo, material); legR.position.set(-0.15, 0.4, 0); dummyGroup.add(legR);
        scene.add(dummyGroup);

        // --- ç‡ˆå…‰ ---
        const ambientLight = new THREE.AmbientLight(0x404040, 1.5); scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5); dirLight.position.set(5, 10, 7); dirLight.castShadow = true; scene.add(dirLight);

        // --- æ§åˆ¶å™¨ ---
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const targetCenter = new THREE.Vector3(0, 1.2, 0);
        controls.target.copy(targetCenter); controls.update();

        // --- V5 æ–°åŠŸèƒ½ï¼šå°èˆªæŒ‰éˆ•é‚è¼¯ ---
        // æ—‹è½‰ (å·¦å³)
        document.getElementById('navLeft').addEventListener('click', () => {
            controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), -0.1); controls.update();
        });
        document.getElementById('navRight').addEventListener('click', () => {
            controls.autoRotate = false; camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), 0.1); controls.update();
        });
        // ç¸®æ”¾ (å‰å¾Œ) - æ²¿è‘—ç›¸æ©Ÿè¦–ç·šæ–¹å‘ç§»å‹•
        document.getElementById('navZoomIn').addEventListener('click', () => {
            const direction = new THREE.Vector3(); camera.getWorldDirection(direction);
            camera.position.add(direction.multiplyScalar(0.5)); controls.update();
        });
        document.getElementById('navZoomOut').addEventListener('click', () => {
            const direction = new THREE.Vector3(); camera.getWorldDirection(direction);
            camera.position.add(direction.multiplyScalar(-0.5)); controls.update();
        });
        // å¹³ç§» (ä¸Šä¸‹) - é€™è£¡ç°¡å–®ç§»å‹•ç›®æ¨™é»å’Œç›¸æ©Ÿ
        document.getElementById('navUp').addEventListener('click', () => {
            camera.position.y += 0.2; controls.target.y += 0.2; controls.update();
        });
        document.getElementById('navDown').addEventListener('click', () => {
            camera.position.y -= 0.2; controls.target.y -= 0.2; controls.update();
        });

        // é‡ç½®æŒ‰éˆ•
        document.getElementById('resetBtn').addEventListener('click', () => {
            camera.position.copy(initialCamPos); controls.target.copy(targetCenter); controls.update();
            document.getElementById('focalLength').value = 35; updateCameraFOV();
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight);
        });
        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
        animate();

        // --- é‚è¼¯æ ¸å¿ƒ ---
        const focalInput = document.getElementById('focalLength');
        function updateCameraFOV() {
            const focalLength = parseFloat(focalInput.value); if(focalLength <= 0) return;
            const sensorHeight = 24; const fov = 2 * Math.atan(sensorHeight / (2 * focalLength)) * (180 / Math.PI);
            camera.fov = fov; camera.updateProjectionMatrix();
        }
        focalInput.addEventListener('input', updateCameraFOV); updateCameraFOV();

        document.getElementById('generateBtn').addEventListener('click', () => {
            const focalLen = focalInput.value; const aperture = document.getElementById('aperture').value;
            const style = document.getElementById('style').value; const aspectRatio = document.getElementById('aspectRatio').value;
            const userDesc = document.getElementById('sceneDesc').value.trim() || "a character standing";

            // 1. è·é›¢ (Shot Size)
            const distance = camera.position.distanceTo(controls.target);
            let shotType = "Medium Shot";
            if (distance < 1.5) shotType = "Extreme Close-up";
            else if (distance < 2.5) shotType = "Close-up";
            else if (distance < 4.5) shotType = "Medium Shot";
            else if (distance < 8.0) shotType = "Full Body Shot";
            else shotType = "Wide Shot";

            // 2. é«˜åº¦ (Angle)
            const heightDiff = camera.position.y - controls.target.y;
            let angleType = "Eye-level angle";
            if (heightDiff > 0.8) angleType = "High angle shot";
            else if (heightDiff < -0.5) angleType = "Low angle shot";

            // 3. æ–¹å‘ (Facing Direction) - V5 å¾®èª¿é–¾å€¼
            let camDirX = camera.position.x - controls.target.x;
            let camDirZ = camera.position.z - controls.target.z;
            const length = Math.sqrt(camDirX * camDirX + camDirZ * camDirZ);
            camDirZ /= length; 
            const dotProduct = camDirZ;

            let facingType = "";
            // å°‡æ­£é¢å’ŒèƒŒé¢çš„åˆ¤å®šç¯„åœç¸®å° (0.7 -> 0.8)ï¼Œè®“å´é¢åˆ¤å®šæ›´æ˜ç¢º
            if (dotProduct > 0.8) { facingType = ", Front view"; } 
            else if (dotProduct < -0.8) { facingType = ", Back view from behind"; } 
            else {
                if (camera.position.x > controls.target.x) { facingType = ", Side profile view facing left"; } 
                else { facingType = ", Side profile view facing right"; }
            }

            const finalPrompt = `"${style}, ${userDesc}${facingType}, ${shotType}, ${angleType}, ${focalLen}mm lens, ${aperture}, depth of field, natural lighting, highly detailed --v 6.0 ${aspectRatio}"`;
            document.getElementById('result-area').innerText = finalPrompt;
        });
    </script>
</body>
</html>